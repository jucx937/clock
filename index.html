<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç­ç´šå¤šåŠŸèƒ½é¬§é˜ç³»çµ±</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #eef2f7; display: flex; justify-content: center; padding: 20px; }
        .container { background: white; width: 450px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { color: #333; text-align: center; }
        .time-now { font-size: 3rem; text-align: center; font-weight: bold; color: #1a73e8; margin-bottom: 20px; }
        
        .setup-box { background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #dee2e6; }
        .input-group { margin-bottom: 10px; }
        label { display: block; font-size: 0.9rem; margin-bottom: 5px; color: #555; }
        input, select { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: 0.3s; }
        .btn-add { background-color: #34a853; color: white; margin-top: 10px; }
        .btn-system { background-color: #1a73e8; color: white; margin-bottom: 15px; }
        .btn-system.active { background-color: #dc3545; }

        .alarm-list { margin-top: 20px; }
        .alarm-item { background: #fff; border: 1px solid #eee; padding: 10px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .alarm-info { flex-grow: 1; }
        .alarm-time { font-weight: bold; font-size: 1.1rem; }
        .btn-delete { background: #ff4d4d; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
        .btn-preview { background: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; margin-right: 5px; }

        .active-flash { animation: flash 0.5s infinite; }
        @keyframes flash { 50% { background-color: #ffcccc; } }
    </style>
</head>
<body>

<div class="container" id="mainContainer">
    <h2>ç­ç´šé¬§é˜ç³»çµ±</h2>
    <div id="clock" class="time-now">00:00:00</div>

    <button id="systemBtn" class="btn btn-system" onclick="toggleSystem()">1. å•Ÿå‹•éŸ³è¨Šæˆæ¬Š (å¿…æŒ‰)</button>

    <div class="setup-box">
        <div class="input-group">
            <label>è¨­å®šæ™‚é–“ï¼š</label>
            <input type="time" id="newTime" step="1">
        </div>
        <div class="input-group">
            <label>é¸æ“‡éˆ´è²ï¼š</label>
            <select id="soundSelect">
                <option value="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3">æ¨™æº–é›»å­éŸ³</option>
                <option value="https://assets.mixkit.co/active_storage/sfx/1017/1017-preview.mp3">æ¸…è„†é˜è²</option>
                <option value="https://assets.mixkit.co/active_storage/sfx/995/995-preview.mp3">å¿«ç¯€å¥è­¦å ±</option>
                <option value="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3">æŸ”å’Œæç¤ºéŸ³</option>
                <option value="https://assets.mixkit.co/active_storage/sfx/1003/1003-preview.mp3">å¾©å¤é›»è©±éŸ³</option>
            </select>
        </div>
        <button class="btn btn-add" onclick="addAlarm()">+ æ–°å¢é¬§é˜</button>
        <button class="btn" style="background:#6c757d; color:white; margin-top:5px; padding:5px;" onclick="previewSelected()">ğŸ”Š è©¦è½é¸ä¸­éˆ´è²</button>
    </div>

    <div class="alarm-list" id="alarmList">
        </div>
</div>

<audio id="globalPlayer"></audio>

<script>
    let alarms = JSON.parse(localStorage.getItem('classAlarms')) || [];
    let isSystemActive = false;

    // åˆå§‹åŒ–ï¼šé¡¯ç¤ºç¾åœ¨æ™‚é–“èˆ‡è®€å–èˆŠæœ‰é¬§é˜
    setInterval(updateClock, 500);
    renderAlarms();
    document.getElementById('newTime').value = new Date().toTimeString().slice(0, 8);

    function updateClock() {
        const now = new Date();
        const timeStr = now.toTimeString().split(' ')[0];
        document.getElementById('clock').innerText = timeStr;

        if (isSystemActive) {
            checkAlarms(timeStr);
        }
    }

    function toggleSystem() {
        isSystemActive = !isSystemActive;
        const btn = document.getElementById('systemBtn');
        if (isSystemActive) {
            // å˜—è©¦æ’­æ”¾éœéŸ³ä»¥è§£é–æ¬Šé™
            const audio = document.getElementById('globalPlayer');
            audio.src = "https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3";
            audio.play().then(() => { audio.pause(); });
            
            btn.innerText = "ç³»çµ±é‹è¡Œä¸­ (é»æ“Šåœæ­¢)";
            btn.classList.add('active');
        } else {
            btn.innerText = "1. å•Ÿå‹•éŸ³è¨Šæˆæ¬Š (å¿…æŒ‰)";
            btn.classList.remove('active');
        }
    }

    function addAlarm() {
        const time = document.getElementById('newTime').value;
        const sound = document.getElementById('soundSelect').value;
        const soundName = document.getElementById('soundSelect').options[document.getElementById('soundSelect').selectedIndex].text;
        
        if (!time) return alert("è«‹è¨­å®šæ™‚é–“");

        alarms.push({ time, sound, soundName, hasTriggered: false });
        saveAndRender();
    }

    function previewSelected() {
        const sound = document.getElementById('soundSelect').value;
        playSample(sound);
    }

    function playSample(url) {
        const audio = document.getElementById('globalPlayer');
        audio.src = url;
        audio.play();
        setTimeout(() => { audio.pause(); }, 3000); // è©¦è½3ç§’
    }

    function checkAlarms(nowStr) {
        alarms.forEach(alarm => {
            if (nowStr === alarm.time && !alarm.hasTriggered) {
                triggerAlarm(alarm);
            }
            if (nowStr !== alarm.time) {
                alarm.hasTriggered = false;
            }
        });
    }

    function triggerAlarm(alarm) {
        alarm.hasTriggered = true;
        const audio = document.getElementById('globalPlayer');
        audio.src = alarm.sound;
        audio.loop = true;
        audio.play();
        
        document.body.classList.add('active-flash');
        
        // éŸ¿éˆ´10ç§’å¾Œè‡ªå‹•åœæ­¢
        setTimeout(() => {
            audio.pause();
            document.body.classList.remove('active-flash');
        }, 10000);
    }

    function deleteAlarm(index) {
        alarms.splice(index, 1);
        saveAndRender();
    }

    function saveAndRender() {
        localStorage.setItem('classAlarms', JSON.stringify(alarms));
        renderAlarms();
    }

    function renderAlarms() {
        const list = document.getElementById('alarmList');
        list.innerHTML = "";
        alarms.sort((a,b) => a.time.localeCompare(b.time)).forEach((alarm, index) => {
            const item = document.createElement('div');
            item.className = 'alarm-item';
            item.innerHTML = `
                <div class="alarm-info">
                    <div class="alarm-time">${alarm.time}</div>
                    <div style="font-size:0.8rem; color: #777;">ğŸ”” ${alarm.soundName}</div>
                </div>
                <button class="btn-preview" onclick="playSample('${alarm.sound}')">â–¶</button>
                <button class="btn-delete" onclick="deleteAlarm(${index})">åˆªé™¤</button>
            `;
            list.appendChild(item);
        });
    }
</script>
</body>
</html>
