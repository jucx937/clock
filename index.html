<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç­ç´šé¬§é˜ç³»çµ±</title>
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #f0f4f8; display: flex; justify-content: center; padding: 20px; margin: 0; }
        .container { background: white; width: 1250px; max-width: 98vw; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); text-align: center; }
        
        .clock-container { background: #e8f0fe; border-radius: 15px; padding: 15px; display: inline-block; min-width: 380px; margin-bottom: 20px; }
        .clock { font-size: 4rem; font-weight: bold; color: #1a73e8; line-height: 1.1; }
        .date-display { font-size: 1.5rem; color: #555; font-weight: bold; margin-top: 5px; border-top: 1px solid #c4d7f5; padding-top: 5px; }
        
        /* åœæ­¢æŒ‰éˆ•å¿ƒè·³å‹•ç•« */
        @keyframes pulse-red {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(217, 48, 37, 0.7); }
            50% { transform: scale(1.08); box-shadow: 0 0 0 20px rgba(217, 48, 37, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(217, 48, 37, 0); }
        }
        .btn-stop { 
            background: #d93025; color: white; border: none; font-weight: bold; 
            display: none; padding: 20px 50px; font-size: 2.2rem; margin-top: 15px; 
            border-radius: 20px; cursor: pointer; animation: pulse-red 1.5s infinite;
        }

        /* æ©«å‘æ’ç‰ˆï¼šä½¿ç”¨ flex ä½ˆå±€ä¸¦ç¢ºä¿é …ç›®ä¸é‡ç–Š */
        .setup-row { 
            background: #fafafa; padding: 20px; border-radius: 15px; border: 1px solid #eee; 
            display: flex; gap: 15px; align-items: flex-end; margin-bottom: 30px;
            justify-content: space-between;
        }
        .input-item { display: flex; flex-direction: column; text-align: left; }
        .input-item label { font-size: 0.9rem; color: #666; font-weight: bold; margin-bottom: 5px; }
        
        /* ç¢ºä¿æ‰€æœ‰è¼¸å…¥æ¡†èˆ‡æŒ‰éˆ•éƒ½æœ‰æ­£ç¢ºçš„é»æ“Šé«˜åº¦èˆ‡ç¯„åœ */
        input, select, .btn-action { padding: 10px; border-radius: 10px; border: 1px solid #ddd; font-size: 1rem; height: 50px; box-sizing: border-box; }
        .btn-main { background: #1a73e8; color: white; border: none; font-weight: bold; cursor: pointer; height: 60px; font-size: 1.2rem; }
        .btn-add { background: #34a853; color: white; border: none; font-weight: bold; cursor: pointer; min-width: 110px; height: 50px; border-radius: 10px; }
        .btn-listen { background: #6c757d; color: white; border: none; cursor: pointer; min-width: 70px; }

        /* é¬§é˜æ¸…å–®æ’ç‰ˆ */
        #alarmListArea { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px; }
        .alarm-item { text-align: left; padding: 25px; background: #fff; border: 2px solid #e8f0fe; border-radius: 20px; position: relative; box-shadow: 0 6px 15px rgba(0,0,0,0.08); }
        .alarm-title { font-size: 2rem; font-weight: 800; color: #222; margin-bottom: 5px; display: block; line-height: 1.2; }
        .alarm-time { font-size: 1.8rem; font-weight: bold; color: #1a73e8; margin-bottom: 15px; display: block; }
        .tag { display: inline-block; background: #f0f4f8; color: #444; padding: 5px 12px; border-radius: 8px; font-size: 0.95rem; margin-right: 8px; margin-top: 8px; border: 1px solid #ccd; }
        .alarm-item.done { background: #f8f8f8; opacity: 0.7; border-color: #ddd; }
        .delete-btn { position: absolute; right: 15px; top: 15px; color: #ccc; border: none; background: none; cursor: pointer; font-size: 1.8rem; }
        
        @media (max-width: 1200px) { .setup-row { flex-wrap: wrap; } }
    </style>
</head>
<body onclick="unlockAudio()">

<div class="container">
    <h2>ç­ç´šé¬§é˜ç³»çµ±</h2>
    <div class="clock-container">
        <div id="liveClock" class="clock">00:00:00</div>
        <div id="liveDate" class="date-display">0000/00/00 æ˜ŸæœŸä¸€</div>
    </div>
    
    <div style="margin-bottom: 20px;">
        <button id="authBtn" class="btn-main" style="width: 350px;" onclick="startMonitoring()">1. é»æ“Šå•Ÿå‹•ç›£æ§ç³»çµ±</button>
        <br>
        <button id="stopBtn" class="btn-stop" onclick="killAlarm()">ğŸ›‘ åœæ­¢éŸ¿éˆ´</button>
    </div>

    <div class="setup-row">
        <div class="input-item" style="flex: 2;">
            <label>1. é¬§é˜æ¨™é¡Œ</label>
            <input type="text" id="alarmName" placeholder="ä¾‹å¦‚ï¼šæ‰“æƒæ™‚é–“">
        </div>
        
        <div class="input-item" style="flex: 2;">
            <label>2. æ™‚é–“èˆ‡æ’­æ”¾æ–¹å¼</label>
            <div style="display: flex; gap: 5px;">
                <input type="time" id="alarmTime" style="width: 140px;"> <select id="playMode" style="flex: 1;">
                    <option value="seq">å…ˆèªéŸ³â”éˆ´è²</option>
                    <option value="sim">åŒæ­¥æ’­æ”¾</option>
                </select>
            </div>
        </div>

        <div class="input-item" style="flex: 1.5;">
            <label>3. é‡è¤‡èˆ‡é•·åº¦</label>
            <div style="display: flex; gap: 5px;">
                <select id="repeatSelect" style="flex: 1.5;">
                    <option value="once">ä¸€æ¬¡</option><option value="daily">æ¯å¤©</option>
                    <option value="weekday">å¹³æ—¥</option><option value="weekend">é€±æœ«</option>
                    <option value="mon">é€±ä¸€</option><option value="tue">é€±äºŒ</option>
                    <option value="wed">é€±ä¸‰</option><option value="thu">é€±å››</option>
                    <option value="fri">é€±äº”</option><option value="sat">é€±å…­</option><option value="sun">é€±æ—¥</option>
                </select>
                <select id="alarmDuration" style="width: 75px;">
                    <option value="5">5s</option><option value="10">10s</option><option value="20">20s</option><option value="30">30s</option>
                </select>
            </div>
        </div>

        <div class="input-item" style="flex: 2;">
            <label>4. éˆ´è²é¸æ“‡</label>
            <div style="display: flex; gap: 5px;">
                <select id="soundSelect" style="flex: 1;">
                    <option value="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3">æ¨™æº–é›»å­éŸ³</option>
                    <option value="https://assets.mixkit.co/active_storage/sfx/1017/1017-preview.mp3">æ¸…è„†é˜è²</option>
                    <option value="https://assets.mixkit.co/active_storage/sfx/995/995-preview.mp3">å¿«ç¯€å¥è­¦å ±</option>
                    <option value="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3">æŸ”å’Œæç¤ºéŸ³</option>
                    <option value="https://assets.mixkit.co/active_storage/sfx/1003/1003-preview.mp3">å¾©å¤é›»è©±éŸ³</option>
                </select>
                <button class="btn-action btn-listen" onclick="previewSound()">ğŸ”Šè©¦è½</button>
            </div>
        </div>

        <button class="btn-add" onclick="addNewAlarm()">+ æ–°å¢</button>
    </div>

    <div id="alarmListArea"></div>
</div>

<audio id="bellPlayer" loop crossorigin="anonymous"></audio>

<script>
    /* æ ¸å¿ƒé‚è¼¯å®Œå…¨ä¿ç•™è‡ª index (1).html ç©©å®šç‰ˆ */
    let alarms = JSON.parse(localStorage.getItem('savedAlarms')) || [];
    let isMonitoring = false;
    let autoStopTimer = null;
    let lastDate = new Date().getDate();
    let isAudioUnlocked = false;

    setInterval(() => {
        const now = new Date();
        const timeStr = now.toTimeString().split(' ')[0];
        document.getElementById('liveClock').innerText = timeStr;
        
        const days = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
        const dateStr = `${now.getFullYear()}/${(now.getMonth()+1).toString().padStart(2, '0')}/${now.getDate().toString().padStart(2, '0')} ${days[now
