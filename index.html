<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç­ç´šå¤šåŠŸèƒ½é¬§é˜ç³»çµ± - ç°¡åŒ–ç‰ˆ</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #eef2f7; display: flex; justify-content: center; padding: 20px; }
        .container { background: white; width: 450px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .time-now { font-size: 3.5rem; text-align: center; font-weight: bold; color: #1a73e8; margin-bottom: 20px; }
        .setup-box { background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #dee2e6; }
        .input-group { margin-bottom: 10px; }
        label { display: block; font-size: 0.9rem; margin-bottom: 5px; color: #555; }
        input, select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; margin-top: 5px; }
        .btn-system { background-color: #1a73e8; color: white; }
        .btn-add { background-color: #34a853; color: white; }
        .btn-stop { background-color: #dc3545; color: white; display: none; } /* é è¨­éš±è— */
        .alarm-item { background: #fff; border: 1px solid #eee; padding: 10px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .active-alarm { animation: blink 0.5s infinite; }
        @keyframes blink { 50% { background-color: #ffcccc; } }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center;">ç­ç´šé¬§é˜ç³»çµ±</h2>
    <div id="clock" class="time-now">00:00:00</div>

    <button id="systemBtn" class="btn btn-system" onclick="toggleSystem()">1. é»æ“Šæˆæ¬Šè²éŸ³ä¸¦å•Ÿå‹•</button>
    <button id="stopBtn" class="btn btn-stop" onclick="stopAlarm()">ğŸ›‘ åœæ­¢é¬§é˜</button>

    <div class="setup-box">
        <div class="input-group">
            <label>è¨­å®šé¬§é˜åç¨± (é¸å¡«)ï¼š</label>
            <input type="text" id="alarmName" placeholder="ä¾‹å¦‚ï¼šç¬¬ä¸€ç¯€ä¸‹èª²">
        </div>
        <div class="input-group">
            <label>è¨­å®šæ™‚é–“ (æ™‚:åˆ†)ï¼š</label>
            <input type="time" id="newTime"> </div>
        <div class="input-group">
            <label>é¸æ“‡éˆ´è²ï¼š</label>
            <select id="soundSelect">
                <option value="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3">æ¨™æº–é›»å­éŸ³</option>
                <option value="https://assets.mixkit.co/active_storage/sfx/1017/1017-preview.mp3">æ¸…è„†é˜è²</option>
                <option value="https://assets.mixkit.co/active_storage/sfx/995/995-preview.mp3">å¿«ç¯€å¥è­¦å ±</option>
                <option value="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3">æŸ”å’Œæç¤ºéŸ³</option>
                <option value="https://assets.mixkit.co/active_storage/sfx/1003/1003-preview.mp3">å¾©å¤é›»è©±éŸ³</option>
            </select>
        </div>
        <button class="btn btn-add" onclick="addAlarm()">+ æ–°å¢é¬§é˜</button>
    </div>

    <div id="alarmList"></div>
</div>

<audio id="globalPlayer"></audio>

<script>
    let alarms = JSON.parse(localStorage.getItem('classAlarms')) || [];
    let isSystemActive = false;

    setInterval(updateClock, 1000);
    renderAlarms();

    function updateClock() {
        const now = new Date();
        const h = now.getHours().toString().padStart(2, '0');
        const m = now.getMinutes().toString().padStart(2, '0');
        const s = now.getSeconds().toString().padStart(2, '0');
        const currentTime = `${h}:${m}:${s}`;
        document.getElementById('clock').innerText = currentTime;

        if (isSystemActive) {
            checkAlarms(h, m);
        }
    }

    function toggleSystem() {
        isSystemActive = true;
        document.getElementById('systemBtn').innerText = "ç³»çµ±é‹è¡Œä¸­...";
        document.getElementById('systemBtn').style.backgroundColor = "#34a853";
        // è§£é–éŸ³è¨Š
        const audio = document.getElementById('globalPlayer');
        audio.src = "https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3";
        audio.play().then(() => { audio.pause(); });
    }

    function addAlarm() {
        const time = document.getElementById('newTime').value;
        const name = document.getElementById('alarmName').value || "é¬§é˜";
        const sound = document.getElementById('soundSelect').value;
        if (!time) return alert("è«‹è¨­å®šæ™‚é–“");
        alarms.push({ time, name, sound, hasTriggered: false });
        saveAndRender();
    }

    function checkAlarms(h, m) {
        const currentHM = `${h}:${m}`;
        alarms.forEach(alarm => {
            if (currentHM === alarm.time && !alarm.hasTriggered) {
                triggerAlarm(alarm);
            }
            if (currentHM !== alarm.time) {
                alarm.hasTriggered = false; // åˆ†é˜éå¾Œé‡ç½®æ¨™è¨˜
            }
        });
    }

    function triggerAlarm(alarm) {
        alarm.hasTriggered = true;
        const audio = document.getElementById('globalPlayer');
        audio.src = alarm.sound;
        audio.loop = true;
        audio.play();
        
        document.getElementById('stopBtn').style.display = "block";
        document.body.classList.add('active-alarm');

        // è·³å‡ºæç¤ºè¦–çª—ï¼Œé»æ“Šç¢ºå®šæœƒé—œé–‰é¬§é˜
        setTimeout(() => {
            if (confirm(`â° é¬§é˜éŸ¿äº†ï¼š${alarm.name}\né»æ“Šã€Œç¢ºå®šã€é—œé–‰éˆ´è²`)) {
                stopAlarm();
            }
        }, 100);
    }

    function stopAlarm() {
        const audio = document.getElementById('globalPlayer');
        audio.pause();
        audio.currentTime = 0;
        document.getElementById('stopBtn').style.display = "none";
        document.body.classList.remove('active-alarm');
    }

    function deleteAlarm(index) {
        alarms.splice(index, 1);
        saveAndRender();
    }

    function saveAndRender() {
        localStorage.setItem('classAlarms', JSON.stringify(alarms));
        renderAlarms();
    }

    function renderAlarms() {
        const list = document.getElementById('alarmList');
        list.innerHTML = "";
        alarms.sort((a,b) => a.time.localeCompare(b.time)).forEach((alarm, index) => {
            const item = document.createElement('div');
            item.className = 'alarm-item';
            item.innerHTML = `
                <div><b>${alarm.time}</b> - ${alarm.name}</div>
                <button onclick="deleteAlarm(${index})" style="background:#ff4d4d; color:white; border:none; border-radius:4px; padding:5px 10px; cursor:pointer;">åˆªé™¤</button>
            `;
            list.appendChild(item);
        });
    }
</script>
</body>
</html>
